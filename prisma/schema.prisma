// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
// Every change needs to be followed by a `npx prisma generate` command to update the Prisma Client.

datasource db {
  provider                = "postgresql"
}

generator client {
  provider                = "prisma-client"
  output                  = "../lib/generated/client"
}

generator pothos {
  provider                = "prisma-pothos-types"
  output                  = "../lib/pothos-prisma-types.ts"
  clientOutput            = "./generated/client/client"
}

generator zod {
  provider                = "prisma-zod-generator"
  output                  = "../lib/zod/generated"
  addInputTypeValidation  = true
  prismaClientPath        = "../../generated/client/client"
}

// ----------------------------------
// TEXT DOCUMENT
// ----------------------------------

/// A text document (e.g. speech, article, etc.), independent of language.
model TextDocument {
  id              String            @id @default(cuid(2))
  createdAt       DateTime          @default(now())

  /// The author(s) contributing to this document.
  authors         Author[]          @relation("TextAuthors")

  /// Language-specific variants of this document.
  variants        TextLanguageVariant[]
}

/// A language-specific variant of a text document (ISO 639-1 language code).
model TextLanguageVariant {
  id              String            @id @default(cuid(2))
  languageCode    String                                          // e.g. "en", "de", "fr"
  title           String
  createdAt       DateTime          @default(now())

  /// Paragraphs that make up this specific language version.
  paragraphs      Paragraph[]

  /// Parent document reference.
  textDocument    TextDocument      @relation(fields: [textDocumentId], references: [id])
  textDocumentId  String

  /// Ensures a document has at most one variant per language.
  @@unique([textDocumentId, languageCode])
}

/// A paragraph belonging to a specific language variant of a text document.
model Paragraph {
  id              String            @id @default(cuid(2))
  order           Int
  content         String

  /// Reference to the parent TextLanguageVariant.
  textLanguageVariant     TextLanguageVariant       @relation(fields: [textLanguageVariantId], references: [id])
  textLanguageVariantId   String
}

/// An author who writes or contributes to one or more text documents.
model Author {
  id              String            @id @default(cuid(2))
  name            String
  createdAt       DateTime          @default(now())

  /// Documents authored or co-authored by this person.
  textDocuments   TextDocument[]    @relation("TextAuthors")
}